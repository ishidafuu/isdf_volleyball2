# データベーススキーマ設計ガイドライン
(knowledge_database_schema_guidelines.md)

## 1. スキーマ設計プロセス

### 1.1 準備フェーズ
1. 要件の明確化
   - 格納するデータの種類と構造の特定
   - データの関連性の整理
   - 想定されるクエリパターンの列挙
   - 想定データ量の見積もり

2. 既存スキーマの調査
   - 関連する既存テーブルの確認
   - 既存の命名規則・規約の確認
   - 類似テーブルの設計パターン確認

### 1.2 設計フェーズ
1. テーブル定義
   - テーブル名の決定（knowledge_database_naming_conventions.mdを参照）
   - 主キーの設計
   - カラムの定義（型、制約、説明）
   - インデックスの設計
   - タイムスタンプカラム(created_at,update_at)は不要

2. リレーション設計
   - 外部キー制約の定義
   - 参照整合性の確認
   - カスケード動作の決定

### 1.3 レビューフェーズ
1. レビュー準備
   - スキーマ定義書の作成（template_database_schema.mdを使用）
   - テーブル関連図の作成
   - サンプルデータの準備

2. レビュー実施
   - 設計レビューの実施
   - フィードバックの収集と対応
   - 最終承認の取得

## 2. スキーマ定義要件

### 2.1 必須要素
1. 基本情報
   - テーブル名
   - テーブルの説明
   - 想定レコード数

2. カラム定義
   - カラム名
   - データ型
   - NULL許可/不許可
   - デフォルト値
   - 制約条件
   - カラムの説明

3. インデックス情報
   - インデックス名
   - 対象カラム
   - インデックスタイプ
   - 理由・目的

### 2.2 命名規則
※詳細はknowledge_database_naming_conventions.mdを参照

1. テーブル名
   - 複数形を使用
   - スネークケース
   - 意味のある省略は許可

2. カラム名
   - スネークケース
   - ID参照は_idサフィックス必須
   - 日時は_atサフィックス
   - フラグはis_プレフィックス

## 3. レビュー基準

### 3.1 基本チェック項目
1. 命名規則の遵守
2. データ型の適切性
3. 制約の妥当性
4. インデックスの適切性

### 3.2 詳細チェック項目
1. 正規化レベルの適切性
2. パフォーマンスへの影響
3. 拡張性の確保
4. データ整合性の担保

### 3.3 運用面のチェック項目
1. バックアップ/リストア手順
2. データ移行の容易性
3. 監視/メンテナンス性

## 4. 承認プロセス

### 4.1 承認フロー
1. スキーマ定義書の提出
2. レビュー実施（template_review_checklist.mdを使用）
3. フィードバック対応
4. 最終承認取得

### 4.2 必要な承認項目
1. テーブル定義の妥当性
2. リレーションの適切性
3. 運用面での実現性
4. 既存システムへの影響

## 5. 変更管理

### 5.1 スキーマ変更時の手順
1. 変更影響範囲の特定
2. 変更計画の立案
3. レビューと承認
4. 実施と検証

### 5.2 ドキュメント更新
1. スキーマ定義書の更新
2. 関連ドキュメントの更新
3. 変更履歴の記録