# エピソード管理ワークフロー

## 1. エピソード作成の基本フロー

### 1.1 前提確認
1. 既存エピソードの確認
   - 関連するエピソードの有無
   - 時系列の整合性
   - 関連キャラクターの確認

2. 必要な参照情報の収集
   - キャラクターID
   - 学校ID
   - 関連する試合情報

### 1.2 エピソードファイル作成
1. 配置場所の決定
   - 時系列（1_year_ago, 2_years_ago, 3_years_ago）
   - カテゴリ（schools, characters, matches, districts）
   - 必要なディレクトリ階層の確認

2. ファイル名の決定
   - プレフィックス: eps_{timeline略称}_
   - カテゴリ識別子: chr_, sch_, mch_, dst_
   - 識別情報: キャラクター名、学校名など
   - 拡張子: .md

### 1.3 データベース登録
1. episodesテーブルへの登録
   - エピソードの基本情報
   - ファイルパス
   - 関連情報

2. 関連テーブルの更新
   - episode_characters
   - episode_schools
   - その他関連テーブル

## 2. エピソード更新手順

### 2.1 更新前の確認
1. 既存データの確認
   - データベース上の登録内容
   - 関連する他のエピソード
   - 影響範囲の特定

2. 整合性の確認
   - 時系列の整合性
   - キャラクター情報の整合性
   - 学校情報の整合性

### 2.2 更新作業
1. ファイル更新
   - Markdownフォーマットの維持
   - 関連情報の更新
   - バックアップの作成

2. データベース更新
   - 更新日時の記録
   - 関連テーブルの更新
   - 変更履歴の記録

## 3. エピソード間の関連付け

### 3.1 関連付けの種類
1. 直接的な関連
   - 前後の時系列関係
   - 同一イベントの異なる視点
   - キャラクター間の関係

2. 間接的な関連
   - 同一学校の異なるエピソード
   - 同一大会の異なる試合
   - 背景となるエピソード

### 3.2 関連付けの手順
1. データベースでの関連付け
   - episode_relationsテーブルの更新
   - 関連種別の設定
   - 関連の方向性の設定

2. ファイル内での参照
   - 関連エピソードへのリンク
   - 関連情報の記載
   - 相互参照の確認

## 4. エピソードの検証

### 4.1 検証項目
1. 形式的な検証
   - ファイル形式の確認
   - 必須項目の存在確認
   - 命名規則の遵守

2. 内容の検証
   - 時系列の整合性
   - キャラクター設定との整合性
   - 学校設定との整合性

### 4.2 検証手順
1. 自動検証
   - ファイル形式チェック
   - 必須項目チェック
   - リンク切れチェック

2. 手動検証
   - 内容の整合性確認
   - 関連エピソードとの整合性
   - 設定との整合性

## 5. エラー対応

### 5.1 一般的なエラー
1. ファイル関連
   - パスの誤り
   - フォーマット不正
   - 文字コードの問題

2. データ関連
   - ID参照の誤り
   - 重複登録
   - 整合性エラー

### 5.2 対応手順
1. エラーの特定
   - エラーメッセージの確認
   - エラー箇所の特定
   - 原因の切り分け

2. 修正作業
   - バックアップの作成
   - 修正の実施
   - 影響範囲の確認

3. 再発防止
   - エラー原因の記録
   - チェック項目の追加
   - 手順の見直し

## 6. メンテナンス

### 6.1 定期的な確認
1. 整合性チェック
   - ファイルの存在確認
   - データベースとの整合性
   - リンクの有効性

2. 最新化作業
   - 古いフォーマットの更新
   - 非推奨項目の置き換え
   - ドキュメントの更新

### 6.2 クリーンアップ作業
1. 不要ファイルの削除
   - 未使用ファイルの特定
   - 重複ファイルの整理
   - 一時ファイルの削除

2. データの整理
   - 未使用データの特定
   - 重複データの統合
   - 履歴データの整理